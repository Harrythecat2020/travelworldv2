<!doctype html>
<html lang="nl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Inloggen — WereldExplorer</title>
  <meta name="description" content="Log in of maak een account aan om WereldExplorer te gebruiken." />
  <style>
    :root{
      --bg:#06080f;
      --panel:rgba(13,17,27,0.92);
      --text:#e8ecff;
      --muted:rgba(232,236,255,0.68);
      --line:rgba(255,255,255,0.12);
      --accent:#7aa8ff;
      --good:#45e6b0;
      --bad:#ff6b7a;
      --radius:18px;
      --radius2:14px;
      --shadow:0 18px 60px rgba(0,0,0,.55);
      --sans:ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto,Arial,"Noto Sans";
      --mono:ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,"Liberation Mono","Courier New",monospace;
    }

    *{box-sizing:border-box}
    html,body{height:100%;margin:0}
    body{
      display:grid;
      place-items:center;
      padding:22px;
      background:
        radial-gradient(1100px 700px at 15% -10%, rgba(122,168,255,.35), transparent 55%),
        radial-gradient(900px 600px at 85% 10%, rgba(155,188,255,.25), transparent 55%),
        linear-gradient(180deg,#05070c,#05060a 60%, #05070c);
      color:var(--text);
      font-family:var(--sans);
    }

    a{color:var(--accent);text-decoration:none}
    a:hover{text-decoration:underline}

    .card{
      width:min(560px, 94vw);
      background:var(--panel);
      border:1px solid var(--line);
      border-radius:var(--radius);
      box-shadow:var(--shadow);
      padding:18px;
      backdrop-filter: blur(14px);
    }

    .header{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:10px;
      margin-bottom:14px;
    }

    .brand{display:flex;align-items:center;gap:10px;font-weight:850;letter-spacing:.2px}
    .dot{width:10px;height:10px;border-radius:50%;background:radial-gradient(circle at 30% 30%, #fff, var(--accent));box-shadow:0 0 18px rgba(122,168,255,.6)}

    .tabs{display:flex;gap:8px;align-items:center}
    .tab{
      border:1px solid var(--line);
      background:rgba(255,255,255,0.06);
      color:var(--text);
      padding:9px 12px;
      border-radius:999px;
      cursor:pointer;
      font-weight:760;
    }
    .tab[aria-selected="true"]{
      background:rgba(122,168,255,0.18);
      border-color:rgba(122,168,255,0.35);
    }

    h1{margin:0 0 6px 0;font-size:20px;letter-spacing:.2px}
    .lead{margin:0 0 14px 0;color:var(--muted);font-size:13.5px;line-height:1.5}

    label{display:block;margin-top:12px;font-size:13px;color:var(--muted)}
    input{
      width:100%;
      padding:11px 12px;
      border-radius:12px;
      border:1px solid var(--line);
      background:rgba(255,255,255,0.06);
      color:var(--text);
      margin-top:6px;
      outline:none;
    }
    input:focus{border-color:rgba(122,168,255,0.5);box-shadow:0 0 0 3px rgba(122,168,255,0.12)}

    .row{display:flex;gap:10px;align-items:center;justify-content:space-between;flex-wrap:wrap;margin-top:14px}
    .btn{
      padding:10px 14px;
      border-radius:12px;
      border:1px solid var(--line);
      background:rgba(255,255,255,0.06);
      color:var(--text);
      cursor:pointer;
      font-weight:760;
      letter-spacing:.15px;
      display:inline-flex;
      align-items:center;
      gap:8px;
      transition: transform .06s ease, background .15s ease, border-color .15s ease;
      user-select:none;
    }
    .btn:hover{background:rgba(255,255,255,0.10);border-color:rgba(255,255,255,0.18)}
    .btn:active{transform:translateY(1px)}
    .btn.primary{background:linear-gradient(90deg, rgba(122,168,255,.95), rgba(155,188,255,.95));color:#061022;border:none}
    .btn:disabled{opacity:.5;cursor:not-allowed;transform:none}

    .helper{color:var(--muted);font-size:12.5px;line-height:1.45;margin-top:10px}

    .msg{margin-top:12px;font-size:13px;line-height:1.5;border-radius:12px;padding:10px 12px;border:1px solid var(--line);display:none}
    .msg.err{border-color:rgba(255,107,122,0.35);background:rgba(255,107,122,0.08);color:#ffdbe0}
    .msg.ok{border-color:rgba(69,230,176,0.35);background:rgba(69,230,176,0.08);color:#d7fff3}

    .pwRow{display:flex;gap:10px;align-items:stretch}
    .pwRow input{flex:1}

    .tiny{font-size:12px;color:var(--muted)}

    @media (max-width:520px){
      .pwRow{flex-direction:column}
    }
  </style>
</head>
<body>
  <main class="card" role="main">
    <div class="header">
      <div class="brand"><span class="dot" aria-hidden="true"></span><span>WereldExplorer</span></div>
      <div class="tabs" role="tablist" aria-label="Login tabs">
        <button class="tab" id="tabLogin" role="tab" aria-selected="true" type="button">Inloggen</button>
        <button class="tab" id="tabRegister" role="tab" aria-selected="false" type="button">Account maken</button>
      </div>
    </div>

    <h1 id="title">Inloggen</h1>
    <p class="lead" id="subtitle">Log in om bezienswaardigheden en foto’s te bekijken.</p>

    <form id="form" novalidate>
      <label for="email">E‑mail</label>
      <input id="email" name="email" type="email" autocomplete="email" required placeholder="naam@voorbeeld.nl" />

      <label for="password">Wachtwoord</label>
      <div class="pwRow">
        <input id="password" name="password" type="password" autocomplete="current-password" required minlength="8" placeholder="Minimaal 8 tekens" />
        <button class="btn" type="button" id="togglePw" aria-label="Toon/verberg wachtwoord">Toon</button>
      </div>

      <div id="confirmWrap" style="display:none;">
        <label for="password2">Herhaal wachtwoord</label>
        <input id="password2" name="password2" type="password" autocomplete="new-password" minlength="8" placeholder="Nogmaals" />
      </div>

      <div class="row">
        <button class="btn primary" id="submitBtn" type="submit">Inloggen</button>
        <a class="btn" href="index.html">← Home</a>
        <span class="tiny" id="nextHint" style="margin-left:auto"></span>
      </div>

      <div id="msgErr" class="msg err" role="status" aria-live="polite"></div>
      <div id="msgOk" class="msg ok" role="status" aria-live="polite"></div>

      <div class="helper">
        Je sessie wordt beheerd via een <span style="font-family:var(--mono)">HttpOnly</span> cookie.
        Wachtwoorden worden veilig gehasht in de database.
      </div>
    </form>
  </main>

  <script>
    const qs = new URLSearchParams(location.search);
    const next = qs.get('next') || 'app.html';
    const modeFromUrl = (qs.get('mode') || 'login').toLowerCase();

    const tabLogin = document.getElementById('tabLogin');
    const tabRegister = document.getElementById('tabRegister');
    const title = document.getElementById('title');
    const subtitle = document.getElementById('subtitle');
    const confirmWrap = document.getElementById('confirmWrap');
    const submitBtn = document.getElementById('submitBtn');
    const form = document.getElementById('form');
    const emailEl = document.getElementById('email');
    const pwEl = document.getElementById('password');
    const pw2El = document.getElementById('password2');
    const togglePw = document.getElementById('togglePw');
    const msgErr = document.getElementById('msgErr');
    const msgOk = document.getElementById('msgOk');
    const nextHint = document.getElementById('nextHint');

    let mode = 'login';

    function showErr(text){ msgOk.style.display = 'none'; msgErr.style.display='block'; msgErr.textContent = text; }
    function showOk(text){ msgErr.style.display = 'none'; msgOk.style.display='block'; msgOk.textContent = text; }
    function clearMsg(){ msgErr.style.display='none'; msgOk.style.display='none'; msgErr.textContent=''; msgOk.textContent=''; }

    function setMode(nextMode){
      mode = nextMode;
      const isRegister = mode === 'register';

      tabLogin.setAttribute('aria-selected', String(!isRegister));
      tabRegister.setAttribute('aria-selected', String(isRegister));

      title.textContent = isRegister ? 'Account maken' : 'Inloggen';
      subtitle.textContent = isRegister
        ? 'Maak een account aan om toegang te krijgen tot plekken en foto’s.'
        : 'Log in om bezienswaardigheden en foto’s te bekijken.';

      confirmWrap.style.display = isRegister ? 'block' : 'none';
      submitBtn.textContent = isRegister ? 'Account maken' : 'Inloggen';

      // autocomplete hints
      pwEl.autocomplete = isRegister ? 'new-password' : 'current-password';

      clearMsg();
    }

    function isValidEmail(v){
      return /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(String(v||'').trim());
    }

    async function apiPost(url, body){
      const res = await fetch(url, {
        method: 'POST',
        credentials: 'include',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(body)
      });
      let data = null;
      try { data = await res.json(); } catch {}
      return { res, data };
    }

    tabLogin.addEventListener('click', ()=> setMode('login'));
    tabRegister.addEventListener('click', ()=> setMode('register'));

    togglePw.addEventListener('click', ()=>{
      const t = pwEl.type === 'password' ? 'text' : 'password';
      pwEl.type = t;
      if (pw2El) pw2El.type = t;
      togglePw.textContent = (t === 'password') ? 'Toon' : 'Verberg';
    });

    form.addEventListener('submit', async (e)=>{
      e.preventDefault();
      clearMsg();

      const email = String(emailEl.value||'').trim();
      const password = String(pwEl.value||'');

      if (!isValidEmail(email)) return showErr('Voer een geldig e‑mail adres in.');
      if (password.length < 8) return showErr('Wachtwoord moet minimaal 8 tekens zijn.');
      if (mode === 'register'){
        const password2 = String(pw2El.value||'');
        if (password2 !== password) return showErr('Wachtwoorden komen niet overeen.');
      }

      submitBtn.disabled = true;
      submitBtn.textContent = (mode === 'register') ? 'Account maken…' : 'Inloggen…';

      try {
        const endpoint = (mode === 'register') ? '/api/register' : '/api/login';
        const { res, data } = await apiPost(endpoint, { email, password });

        if (!res.ok) {
          const msg = (data && (data.message || data.error)) ? (data.message || data.error) : 'Er ging iets mis. Probeer opnieuw.';
          return showErr(msg);
        }

        showOk(mode === 'register' ? 'Account aangemaakt! Je wordt doorgestuurd…' : 'Ingelogd! Je wordt doorgestuurd…');
        setTimeout(()=>{ location.href = next; }, 350);
      } catch (err){
        console.error(err);
        showErr('Netwerkfout. Controleer of de server draait en probeer opnieuw.');
      } finally {
        submitBtn.disabled = false;
        submitBtn.textContent = (mode === 'register') ? 'Account maken' : 'Inloggen';
      }
    });

    // init
    if (next && next !== 'app.html') nextHint.textContent = `→ gaat verder naar ${next}`;
    setMode(modeFromUrl === 'register' ? 'register' : 'login');
  </script>
</body>
</html>
